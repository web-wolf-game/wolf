<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="viewport" content="width=device-width">
<link rel="stylesheet" href="style.css">
<script src="https://www.gstatic.com/firebasejs/5.5.6/firebase.js"></script>
<script src="script.js"></script>

<script>

function Main(){localStorage.kfs=localStorage.kfs||"{}";var a=JSON.parse(localStorage.kfs);System.member=a.wolf||{};ServerTime();if(void 0===System.member.account)var e=setInterval(function(){void 0!==System.SerialNumber&&null!==System.SerialNumber&&(clearInterval(e),location.href="wolf.html")},10);System.game=JSON.parse(sessionStorage.game||"{}");System.select_day=System.game.nowday;MenuLi();MenuClick("chat","close")}
function MenuLi(){var a=document.createElement("div");a.id="Time";a.addEventListener("click",function(){document.querySelectorAll("#Menu ul>div").forEach(function(d,l){d.style.height="0px"})});var e=document.createElement("div");e.id="Menu";var f=document.createElement("ul"),h={index:{name:"\u56de\u5230\u64cd\u4f5c\u4ecb\u9762"},chat:{name:"\u4e00\u822c\u5c0d\u8a71\u5ba4"}};"end"==System.game.end&&(h.chat_wolf={name:"\u4eba\u72fc\u5c0d\u8a71\u5ba4"});void 0!==System.game.char_list[System.member.account]&&
"wolf"==System.game.char_list[System.member.account].job&&(h.chat_wolf={name:"\u4eba\u72fc\u5c0d\u8a71\u5ba4"});for(var m in h){var g=document.createElement("li");g.id=m;g.innerHTML=h[m].name;f.appendChild(g);g=document.createElement("div");g.id=m;f.appendChild(g)}e.appendChild(f);document.body.appendChild(a);document.body.appendChild(e);document.querySelectorAll("#Menu ul li").forEach(function(d){d.addEventListener("click",function(){MenuClick(d.id,"close")})})}
function MenuClick(a,e){if("close"==e)document.querySelectorAll("#Menu ul>div").forEach(function(h,m){h.style.height="0px"}),setTimeout(function(){MenuClick(a,"open")},0);else{var f=document.createElement("div");f.id="Main";"index"==a?location.href="wolf.html":"chat"==a?CreateChat(f,a):"chat_wolf"==a?CreateChat(f,a):(document.querySelectorAll("#Menu ul>div").forEach(function(h,m){h.innerHTML=""}),document.querySelector("div#"+a).appendChild(f),setTimeout(function(){document.querySelector("div#"+a).style.height=
document.querySelector("div#"+a+" div#Main").clientHeight+"px"},0))}}
function CreateChat(a,e,f){f=void 0===f?System.select_day:f;var h=document.createElement("div");h.className="chat";var m=document.createElement("ul");h.appendChild(m);var g=document.createElement("div");g.className="info";if(void 0!==System.game.char_list[System.member.account]&&"dead"!=System.game.char_list[System.member.account].dead.status){var d=document.createElement("span");d.className="btn";d.innerHTML="\u767c\u8a00";g.appendChild(d);g.appendChild(document.createElement("p"));d.addEventListener("click",
function(){var c=document.querySelector("#text").value;if(""!=c&&0!=confirm("\u5c07\u5728\u3010"+{chat:"\u4e00\u822c\u5c0d\u8a71",chat_wolf:"\u4eba\u72fc\u5c0d\u8a71"}[e]+"\u3011\u9001\u51fa\u8a0a\u606f\uff0c\u78ba\u5b9a\u8981\u7e7c\u7e8c\u55ce?")){var k=System.game.char_list[System.member.account];if(void 0!=k){var b={};b.char_create=System.member.account;b.time_create=firebase.database.ServerValue.TIMESTAMP;b.account=System.member.account;b.name=k.name;b.nickname=k.nickname;b.day=System.game.nowday;
b.type=e;b.text=c;c=Object.keys(System.game.chat||{}).length;DB.ref("/game/"+System.game.sn+"/chat/"+c).set(b);MenuClick(e,"close")}}});d=document.createElement("textarea");d.id="text";a.appendChild(d)}d=document.createElement("select");for(var l=0;l<=System.game.nowday;l++){var q=document.createElement("option");q.text="\u7b2c"+l+"\u5929";q.value=l;l==System.select_day&&(q.selected="selected");d.appendChild(q)}l=document.createElement("span");l.innerHTML="\u76ee\u524d\u986f\u793a\u7b2c"+f+"\u5929\u8a0a\u606f<BR>\u9078\u64c7\u5176\u4ed6\u5929";
d.addEventListener("change",function(){""!=this.value&&(System.select_day=this.value,MenuClick(e,"close"))});g.appendChild(l);g.appendChild(d);a.appendChild(g);if(void 0===System.game.sn)location.href="wolf.html";else DB.ref("/game/"+System.game.sn).once("value",function(c){c=c.val();if(null===c)location.href="wolf.html";else{System.game=c;sessionStorage.game=JSON.stringify(c);var k=[],b;for(b in c.chat)c.chat[b].type==e&&c.chat[b].day==f&&(k[k.length]=c.chat[b]);k=SortData(k,"time_create",1);for(b in k){c=
document.createElement("li");var n=document.createElement("textarea");n.disabled="disabled";n.value=k[b].text;var t=document.createElement("table"),r=document.createElement("tr"),p=document.createElement("td");t.appendChild(r);r.appendChild(p);p.innerHTML="\u3010"+k[b].nickname+"\u3011";p=document.createElement("td");p.appendChild(n);r.appendChild(p);n=document.createElement("span");n.innerHTML=DateFormat(new Date(k[b].time_create),!1);n.className="time";p.appendChild(n);r.appendChild(p);c.appendChild(t);
m.appendChild(c)}a.appendChild(h);document.querySelectorAll("#Menu ul>div").forEach(function(u,v){u.innerHTML=""});document.querySelector("div#"+e).appendChild(a);setTimeout(function(){document.querySelector("div#"+e).style.height="80%"},0)}})};



</script>
